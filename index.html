<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Playlist YouTube t·ª´ Google Sheets</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(135deg, #f2fdff 0%, #faf0f5 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    #main {
      max-width: 780px;
      margin: 36px auto;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 6px 32px #6dc7ec33, 0 1.5px 7px #ccc;
      padding: 36px 32px 32px 32px;
      position: relative;
      min-height: 450px;
    }
    h1 {
      margin: 0 0 18px 0;
      font-weight: 800;
      font-size: 2.2rem;
      letter-spacing: 0.5px;
      color: #3f5b98;
      text-shadow: 0 1.5px 0 #e7eaf6;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #search {
      margin-bottom: 18px;
      width: 100%;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1.5px solid #c2dbff;
      font-size: 1.1rem;
      outline: none;
      transition: border-color 0.2s;
    }
    #search:focus { border-color: #6198ef; }
    #song-list {
      list-style: none;
      margin: 0;
      padding: 0;
      max-height: 340px;
      overflow-y: auto;
      border-radius: 14px;
      background: #f8fbfe;
      box-shadow: 0 1.5px 6px #e3e6f1;
    }
    #song-list li {
      display: flex;
      align-items: center;
      padding: 13px 16px;
      border-bottom: 1px solid #e9eefb;
      font-size: 1.08rem;
      cursor: pointer;
      transition: background 0.18s;
      position: relative;
      gap: 11px;
    }
    #song-list li.selected, #song-list li:hover {
      background: linear-gradient(90deg, #d7eaff 0%, #fff 60%);
      color: #1469b2;
      font-weight: bold;
    }
    #song-list li:last-child { border-bottom: none; }
    .song-index {
      display: inline-block;
      min-width: 32px;
      color: #6198ef;
      font-weight: bold;
      text-align: right;
      opacity: 0.75;
    }
    .song-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #player, #audio {
      display: none;
      margin: 34px auto 0 auto;
      border-radius: 16px;
      box-shadow: 0 4px 16px #d1e4f5;
      background: #000;
    }
    #player { width: 100%; height: 325px; }
    #audio { width: 100%; }
    .error {
      color: #c00; 
      margin-top: 18px; 
      font-size: 1.11rem;
      font-weight: bold;
    }
    #loading {
      text-align: center;
      font-size: 1.05rem;
      color: #7c8da6;
      margin: 24px 0;
    }
    @media (max-width: 820px) {
      #main { padding: 18px 5vw; }
      #player { height: 225px; }
    }
    @media (max-width: 500px) {
      #main { padding: 9px 1vw; }
      h1 { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
<div id="main">
  <h1>üéµ Playlist c·ªßa t√¥i</h1>
  <input id="search" type="text" placeholder="T√¨m b√†i h√°t...">
  <div id="loading">ƒêang t·∫£i danh s√°ch b√†i h√°t...</div>
  <ul id="song-list"></ul>
  <iframe id="player" allowfullscreen></iframe>
  <audio id="audio" controls></audio>
  <div id="err" class="error"></div>
</div>

<script>
  // API endpoint c·ªßa b·∫°n
  const apiEndpoint = 'https://api.sheetbest.com/sheets/276c7c77-e2f0-4726-9929-7c4848f276bb';
  let allSongs = [];

  function renderList(songs, selectedIdx = 0) {
    const list = document.getElementById('song-list');
    list.innerHTML = '';
    songs.forEach((item, idx) => {
      if (!item["T√™n B√†i H√°t"]) return;
      const li = document.createElement('li');
      li.className = (idx === selectedIdx ? 'selected' : '');
      li.innerHTML = `
        <span class="song-index">${idx + 1}.</span>
        <span class="song-title">${item["T√™n B√†i H√°t"]}</span>
      `;
      li.onclick = function() {
        // Xo√° ch·ªçn c≈© v√† highlight m·ªõi
        document.querySelectorAll('#song-list li').forEach(x => x.classList.remove('selected'));
        li.classList.add('selected');
        playSong(item);
      };
      list.appendChild(li);
    });
  }

  function playSong(item) {
    const player = document.getElementById('player');
    const audio = document.getElementById('audio');
    const errDiv = document.getElementById('err');
    player.style.display = "none";
    audio.style.display = "none";
    player.src = "";
    audio.src = "";
    errDiv.textContent = "";
    // ∆Øu ti√™n m√£ video YouTube
    const videoId = item["M√£ Video"]?.trim();
    const link = item["Link Video"]?.trim();

    if (videoId) {
      player.src = 'https://www.youtube.com/embed/' + videoId;
      player.style.display = 'block';
    }
    else if (link) {
      // Link YouTube
      if (link.includes('youtube.com') || link.includes('youtu.be')) {
        let vid = '';
        if(link.includes('youtube.com')) {
          const m = link.match(/[?&]v=([^&]+)/);
          if(m) vid = m[1];
        } else if(link.includes('youtu.be')) {
          vid = link.split('youtu.be/')[1]?.split(/[?&]/)[0];
        }
        if(vid) {
          player.src = 'https://www.youtube.com/embed/' + vid;
          player.style.display = 'block';
          return;
        }
      }
      // Link mp3
      else if (link.endsWith('.mp3')) {
        audio.src = link;
        audio.style.display = 'block';
        return;
      }
      // Link kh√°c, nh√∫ng v√†o iframe
      else {
        player.src = link;
        player.style.display = 'block';
      }
    } else {
      errDiv.textContent = "Kh√¥ng t√¨m th·∫•y link ph√°t cho b√†i h√°t n√†y!";
    }
  }

  function filterSongs(text) {
    text = text.toLowerCase();
    return allSongs.filter(s => (s["T√™n B√†i H√°t"]||'').toLowerCase().includes(text));
  }

  // Load d·ªØ li·ªáu playlist
  window.addEventListener('DOMContentLoaded', function() {
    fetch(apiEndpoint)
      .then(res => res.json())
      .then(data => {
        allSongs = data.filter(s => s["T√™n B√†i H√°t"]); // b·ªè d√≤ng tr·ªëng
        document.getElementById('loading').style.display = "none";
        if(allSongs.length == 0) {
          document.getElementById('err').textContent = "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu!";
        } else {
          renderList(allSongs, 0);
          playSong(allSongs[0]);
        }
      })
      .catch(function(err) {
        document.getElementById('loading').style.display = "none";
        document.getElementById('err').textContent = 'L·ªói khi t·∫£i d·ªØ li·ªáu! Chi ti·∫øt: ' + err;
      });

    // T√¨m ki·∫øm b√†i h√°t
    document.getElementById('search').addEventListener('input', function(e){
      const value = e.target.value.trim();
      let filtered = value ? filterSongs(value) : allSongs;
      renderList(filtered, 0);
      if(filtered.length) playSong(filtered[0]);
    });
  });
</script>
</body>
</html>
